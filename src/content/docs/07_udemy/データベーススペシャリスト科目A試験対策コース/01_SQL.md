---
title: 01_SQL
---

# SQL

- 試験では、列名やテーブル名は**日本語**で表示されているが、実務では予期せぬエラーを防ぐために**英語**で命名すること
- 列を絞ること＝「射影」、行を絞ること＝「選択」
- 
- `AND`が`OR`よりも優先
- `||`は文字列の結合に使える（Oracle、PostgreSQL、SQLite）※MySQLでは使えないので、代わりに`CONCAT(A,B)`を使用すること
- nullをそのまま表示させたくないときには、
    - `COALESCE`を使う 例）`SELECT COALESCE(列名, '代わりに表示させたい文字列') FROM テーブル名` ※`COALESCE(列名, '代わりに表示させたい文字列')`が新しい列に相当
    - `CASE WHEN`を使う 例）`SELECT CASE WHEN 列名を含む条件文 THEN '代わりに表示させたい文字列1' ELSE '代わりに表示させたい文字列2' END FROM テーブル名`
- ある列の値を重複を削除して表示させたいときは、`DISTINCT`を使う 例）`SELECT DISTINCT 列名 FROM product`
- ある列の値の個数をカウントしたいときは、`COUNT`を使う 例）`SELECT 列名, COUNT(*) FROM テーブル名 GROUP BY 列名`
    - `COUNT(*)`と`COUNT(列名)`の違いは以下
        - `COUNT(*)`：グループ内の全レコード数（`NULL`関係なし）
        - `COUNT(列名)`：グループ内で指定列が`NULL`でないレコードの数
- `WHERE`と`HAVING`、どちらも絞り込むための関数。違いは…
    - `WHERE`は`GROUP BY`よりも前にないとエラーになる。`HAVING`は`GROUP BY`よりも後でOK
    - `WHERE`の中に集約関数を入れてはいけない。`HAVING`は集約関数OK
- `ORDER BY`でソートができる
    - 何でソートするか？はカンマ区切りで並べられる
    - カンマ区切りで並べた場合、左の項目でまずソートして、左の項目が同じものの中でまた次の項目でソートして…というのを繰り返す
    - `ORDER BY`は、最後表示されるときにどういう順番で並べたいかを設定するものなので、一番最後に書く
    - `ORDER BY 列名 DESC`と書くと降順で表示される（デフォルトは昇順（`ASC`））
    - `ORDER BY 数字`と書くと、SELECTで選んだ項目名のうち左から（数字）番目のもので並び替えされる
- `UNION`（和）で2つの抽出結果を縦に並べることができる（重複レコードは排除される）
- `UNION ALL`で2つの抽出結果を縦に並べることができる（重複レコードは排除されない）
    - 列名が上下で揃っていなくても結果は結合される（ただし、列名は上の表のものが採用される）
    - データ型が上下で揃っていないと結果は結合できない（ただし、MySQLだと結合できてしまうこともある）
    - 抽出された列数が上下で揃っていないとエラーになる（上下で抽出された列数が揃っていること、かつ、データ型が上下で揃っていることを**和両立**という）
- `EXCEPT`（差）で2つの抽出結果の差分を表示する
    - 上の表示内容から、下の表示内容と一致するものが削除される
    - EXCEPTを実行するには上下の抽出結果が和両立である必要がある
- `INTERSECT`（積）で2つの抽出結果で一致するレコード（←これを**共通集合**という）だけを表示する
- （直積）で2つの抽出結果を横に並べることができる（左右のレコードをそのままくっつけるのではなく、全組み合わせを網羅するようにくっつける）