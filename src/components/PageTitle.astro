---
import type { Props } from '@astrojs/starlight/props';

const { entry, lang, lastUpdated } = Astro.props;
const publishedDate = entry.data.publishedDate;
const status = entry.data.status;
const PAGE_TITLE_ID = '_top';

// デバッグ用ログ
console.log('PageTitle Debug:', {
  title: entry.data.title,
  publishedDate: publishedDate,
  publishedDateType: typeof publishedDate,
  lastUpdated: lastUpdated,
  status: status,
});
---

<div class="page-title-wrapper">
  <h1 id={PAGE_TITLE_ID}>{entry.data.title}</h1>

  {(publishedDate || lastUpdated || status) && (
    <div class="page-meta">
      {publishedDate && (
        <span class="published-date">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
          投稿日: <time datetime={publishedDate instanceof Date ? publishedDate.toISOString() : publishedDate}>
            {publishedDate instanceof Date
              ? publishedDate.toLocaleDateString(lang, { year: 'numeric', month: 'long', day: 'numeric', timeZone: 'UTC' })
              : new Date(publishedDate).toLocaleDateString(lang, { year: 'numeric', month: 'long', day: 'numeric', timeZone: 'UTC' })
            }
          </time>
        </span>
      )}

      {lastUpdated && (
        <span class="last-updated">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="23 4 23 10 17 10"></polyline>
            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
          </svg>
          最終更新: <time datetime={lastUpdated.toISOString()}>
            {lastUpdated.toLocaleDateString(lang, { year: 'numeric', month: 'long', day: 'numeric', timeZone: 'UTC' })}
          </time>
        </span>
      )}

      {status && (
        <span class={`status-badge status-${status}`}>
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <path d="M12 6v6l4 2"></path>
          </svg>
          {status}
        </span>
      )}
    </div>
  )}
</div>

<style>
  .page-title-wrapper {
    margin-top: 1rem;
  }

  h1 {
    font-size: var(--sl-text-h1);
    line-height: var(--sl-line-height-headings);
    font-weight: 600;
    color: var(--sl-color-white);
    margin-bottom: 0.75rem;
  }

  .page-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem 1.5rem;
    margin-top: 0.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--sl-color-border);
    font-size: 0.875rem;
    color: var(--sl-color-text-muted);
  }

  .page-meta span {
    display: flex;
    align-items: center;
    gap: 0.4rem;
  }

  .page-meta svg {
    flex-shrink: 0;
    width: 16px;
    height: 16px;
    opacity: 0.7;
  }

  .page-meta time {
    color: var(--sl-color-text-main);
    font-weight: 500;
  }

  .status-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    padding: 0.25rem 0.75rem;
    border-radius: 0.375rem;
    font-weight: 500;
    font-size: 0.875rem;
  }

  .status-作成中 {
    background-color: rgba(234, 179, 8, 0.15);
    color: rgb(250, 204, 21);
    border: 1px solid rgba(234, 179, 8, 0.3);
  }

  .status-初版作成完了 {
    background-color: rgba(34, 197, 94, 0.15);
    color: rgb(74, 222, 128);
    border: 1px solid rgba(34, 197, 94, 0.3);
  }

  .status-改訂版作成完了 {
    background-color: rgba(59, 130, 246, 0.15);
    color: rgb(96, 165, 250);
    border: 1px solid rgba(59, 130, 246, 0.3);
  }

  @media (max-width: 48rem) {
    .page-meta {
      flex-direction: column;
      gap: 0.5rem;
    }
  }
</style>
